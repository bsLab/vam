# 1 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
 

(***********************************************************************)
(*                                                                     *)
(*                             xlib                                    *)
(*                                                                     *)
(*       Fabrice Le Fessant, projet Para/SOR, INRIA Rocquencourt       *)
(*                                                                     *)
(*  Copyright 1999 Institut National de Recherche en Informatique et   *)
(*  Automatique.  Distributed only by permission.                      *)
(*                                                                     *)
(***********************************************************************)



  open Xtypes
  open Zpixmap
  open Lexing
    
  exception BadFile of string * int
(* To buffer string literals *)
  
  let initial_string_buffer = String.create 256
  let string_buff = ref initial_string_buffer
  let string_index = ref 0
  let string_start_pos = ref 0
  
  let reset_string_buffer () =
    string_buff := initial_string_buffer;
    string_index := 0
  
  let store_string_char c =
    if !string_index >= String.length (!string_buff) then begin
        let new_buff = String.create (String.length (!string_buff) * 2) in
        String.blit (!string_buff) 0 new_buff 0 (String.length (!string_buff));
        string_buff := new_buff
      end;
    String.unsafe_set (!string_buff) (!string_index) c;
    incr string_index
  
  let get_stored_string () =
    let s = String.sub (!string_buff) 0 (!string_index) in
    string_buff := initial_string_buffer;
    s
    
  let code = ref ""
  let read = ref 0
  
  let width = ref 0
  let height = ref 0
  let hot_x = ref 0
  let hot_y = ref 0
  
  let hexcode lexbuf i = 
    let c = Char.lowercase (Lexing.lexeme_char lexbuf i) in
    if c>= '0' && c <='9' then (Char.code c) - (Char.code '0')
    else
    if c>= 'a' && c <= 'f' then
      Char.code c - Char.code 'a' + 10
    else
      raise (BadFile ("hexcode",Lexing.lexeme_start lexbuf))

let lex_tables = {
  Lexing.lex_base = 
   "\000\000\001\000\002\000\005\000\004\000\003\000\017\000\006\000\
    \007\000\034\000\078\000\032\000\252\255\000\000\006\000\253\255\
    \253\255\008\000\009\000\254\255\255\255\248\255\005\000\055\000\
    \250\255\249\255\026\000\023\000\000\000\001\000\026\000\047\000\
    \044\000\251\255\057\000\051\000\047\000\064\000\049\000\062\000\
    \062\000\065\000\065\000\054\000\250\255\251\255\243\000\062\001\
    \137\001\212\001\031\002\106\002\181\002\000\003\075\003\150\003\
    \225\003\044\004\119\004\194\004\013\005\088\005\163\005\238\005\
    \254\255\072\000\000\000\255\255\255\255\006\000\005\000\255\255\
    \129\000\139\000\154\000\164\000\021\000";
  Lexing.lex_backtrk = 
   "\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\003\000\003\000\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\007\000\007\000\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\005\000\003\000\
    \003\000\003\000\003\000\003\000\002\000\255\255\255\255\255\255\
    \255\255\255\255\001\000\255\255\255\255\255\255\255\255\255\255\
    \255\255\001\000\255\255\255\255\255\255\002\000\002\000\255\255\
    \003\000\001\000\001\000\002\000\003\000";
  Lexing.lex_default = 
   "\016\000\016\000\012\000\012\000\019\000\016\000\016\000\067\000\
    \064\000\044\000\021\000\012\000\000\000\255\255\255\255\000\000\
    \000\000\018\000\019\000\000\000\000\000\000\000\255\255\255\255\
    \000\000\000\000\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\000\000\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\000\000\000\000\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \000\000\255\255\255\255\000\000\000\000\255\255\255\255\000\000\
    \255\255\255\255\255\255\255\255\255\255";
  Lexing.lex_trans = 
   "\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\020\000\000\000\000\000\000\000\000\000\071\000\071\000\
    \065\000\071\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \020\000\000\000\068\000\068\000\071\000\071\000\067\000\065\000\
    \019\000\016\000\020\000\045\000\045\000\070\000\045\000\020\000\
    \019\000\076\000\072\000\068\000\020\000\073\000\073\000\073\000\
    \073\000\073\000\073\000\073\000\073\000\073\000\073\000\019\000\
    \069\000\000\000\045\000\000\000\000\000\046\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\013\000\
    \014\000\000\000\047\000\047\000\047\000\047\000\047\000\047\000\
    \047\000\047\000\047\000\047\000\000\000\000\000\000\000\034\000\
    \030\000\000\000\000\000\047\000\047\000\047\000\047\000\047\000\
    \047\000\047\000\047\000\047\000\047\000\047\000\047\000\047\000\
    \048\000\047\000\047\000\047\000\047\000\047\000\047\000\047\000\
    \047\000\047\000\047\000\047\000\047\000\022\000\017\000\040\000\
    \037\000\047\000\031\000\047\000\047\000\047\000\047\000\047\000\
    \047\000\047\000\047\000\047\000\047\000\047\000\047\000\047\000\
    \048\000\047\000\047\000\047\000\047\000\047\000\047\000\047\000\
    \047\000\047\000\047\000\047\000\047\000\015\000\032\000\026\000\
    \033\000\035\000\036\000\012\000\038\000\039\000\019\000\041\000\
    \042\000\043\000\016\000\066\000\000\000\023\000\027\000\028\000\
    \029\000\075\000\075\000\075\000\075\000\075\000\075\000\075\000\
    \075\000\075\000\075\000\074\000\074\000\074\000\074\000\074\000\
    \074\000\074\000\074\000\074\000\074\000\000\000\000\000\000\000\
    \000\000\024\000\074\000\074\000\074\000\074\000\074\000\074\000\
    \074\000\074\000\074\000\074\000\075\000\075\000\075\000\075\000\
    \075\000\075\000\075\000\075\000\075\000\075\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \019\000\019\000\016\000\019\000\255\255\255\255\255\255\255\255\
    \255\255\255\255\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\255\255\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \016\000\000\000\255\255\053\000\053\000\053\000\053\000\053\000\
    \053\000\053\000\053\000\053\000\053\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\053\000\053\000\053\000\053\000\
    \053\000\053\000\053\000\053\000\053\000\053\000\053\000\053\000\
    \053\000\053\000\053\000\053\000\053\000\053\000\053\000\053\000\
    \053\000\053\000\053\000\053\000\053\000\053\000\025\000\000\000\
    \000\000\000\000\000\000\000\000\053\000\053\000\053\000\053\000\
    \053\000\053\000\053\000\053\000\053\000\053\000\053\000\053\000\
    \053\000\053\000\053\000\053\000\053\000\053\000\053\000\053\000\
    \053\000\053\000\053\000\053\000\053\000\053\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\000\000\000\000\000\000\000\000\049\000\000\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \050\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\000\000\000\000\000\000\000\000\
    \049\000\000\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \050\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\000\000\
    \000\000\000\000\000\000\049\000\000\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\051\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\000\000\000\000\000\000\000\000\049\000\000\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\051\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\049\000\049\000\049\000\049\000\052\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\000\000\000\000\000\000\
    \000\000\049\000\000\000\049\000\049\000\049\000\049\000\052\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \000\000\000\000\000\000\000\000\049\000\000\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \054\000\054\000\054\000\054\000\054\000\054\000\054\000\054\000\
    \054\000\054\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\054\000\054\000\054\000\054\000\054\000\054\000\054\000\
    \054\000\054\000\054\000\054\000\054\000\054\000\054\000\054\000\
    \054\000\054\000\054\000\054\000\054\000\054\000\054\000\054\000\
    \054\000\054\000\054\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\054\000\054\000\054\000\054\000\054\000\054\000\054\000\
    \054\000\054\000\054\000\054\000\054\000\054\000\054\000\054\000\
    \054\000\054\000\054\000\054\000\054\000\054\000\054\000\054\000\
    \054\000\054\000\054\000\055\000\055\000\055\000\055\000\055\000\
    \055\000\055\000\055\000\055\000\055\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\055\000\055\000\055\000\055\000\
    \055\000\055\000\055\000\055\000\055\000\055\000\055\000\055\000\
    \055\000\055\000\055\000\055\000\055\000\055\000\055\000\055\000\
    \055\000\055\000\055\000\055\000\055\000\055\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\055\000\055\000\055\000\055\000\
    \055\000\055\000\055\000\055\000\055\000\055\000\055\000\055\000\
    \055\000\055\000\055\000\055\000\055\000\055\000\055\000\055\000\
    \055\000\055\000\055\000\055\000\055\000\055\000\056\000\056\000\
    \056\000\056\000\056\000\056\000\056\000\056\000\056\000\056\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\056\000\
    \056\000\056\000\056\000\056\000\056\000\056\000\056\000\056\000\
    \056\000\056\000\056\000\056\000\056\000\056\000\056\000\056\000\
    \056\000\056\000\056\000\056\000\056\000\056\000\056\000\056\000\
    \056\000\000\000\000\000\000\000\000\000\000\000\000\000\056\000\
    \056\000\056\000\056\000\056\000\056\000\056\000\056\000\056\000\
    \056\000\056\000\056\000\056\000\056\000\056\000\056\000\056\000\
    \056\000\056\000\056\000\056\000\056\000\056\000\056\000\056\000\
    \056\000\057\000\057\000\057\000\057\000\057\000\057\000\057\000\
    \057\000\057\000\057\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\057\000\057\000\057\000\057\000\057\000\057\000\
    \057\000\057\000\057\000\057\000\057\000\057\000\057\000\057\000\
    \057\000\057\000\057\000\057\000\057\000\057\000\057\000\057\000\
    \057\000\057\000\057\000\057\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\057\000\057\000\057\000\057\000\057\000\057\000\
    \057\000\057\000\057\000\057\000\057\000\057\000\057\000\057\000\
    \057\000\057\000\057\000\057\000\057\000\057\000\057\000\057\000\
    \057\000\057\000\057\000\057\000\058\000\058\000\058\000\058\000\
    \058\000\058\000\058\000\058\000\058\000\058\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\058\000\058\000\058\000\
    \058\000\058\000\058\000\058\000\058\000\058\000\058\000\058\000\
    \058\000\058\000\058\000\058\000\058\000\058\000\058\000\058\000\
    \058\000\058\000\058\000\058\000\058\000\058\000\058\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\058\000\058\000\058\000\
    \058\000\058\000\058\000\058\000\058\000\058\000\058\000\058\000\
    \058\000\058\000\058\000\058\000\058\000\058\000\058\000\058\000\
    \058\000\058\000\058\000\058\000\058\000\058\000\058\000\059\000\
    \059\000\059\000\059\000\059\000\059\000\059\000\059\000\059\000\
    \059\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \059\000\059\000\059\000\059\000\059\000\059\000\059\000\059\000\
    \059\000\059\000\059\000\059\000\059\000\059\000\059\000\059\000\
    \059\000\059\000\059\000\059\000\059\000\059\000\059\000\059\000\
    \059\000\059\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \059\000\059\000\059\000\059\000\059\000\059\000\059\000\059\000\
    \059\000\059\000\059\000\059\000\059\000\059\000\059\000\059\000\
    \059\000\059\000\059\000\059\000\059\000\059\000\059\000\059\000\
    \059\000\059\000\060\000\060\000\060\000\060\000\060\000\060\000\
    \060\000\060\000\060\000\060\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\060\000\060\000\060\000\060\000\060\000\
    \060\000\060\000\060\000\060\000\060\000\060\000\060\000\060\000\
    \060\000\060\000\060\000\060\000\060\000\060\000\060\000\060\000\
    \060\000\060\000\060\000\060\000\060\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\060\000\060\000\060\000\060\000\060\000\
    \060\000\060\000\060\000\060\000\060\000\060\000\060\000\060\000\
    \060\000\060\000\060\000\060\000\060\000\060\000\060\000\060\000\
    \060\000\060\000\060\000\060\000\060\000\061\000\061\000\061\000\
    \061\000\061\000\061\000\061\000\061\000\061\000\061\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\061\000\061\000\
    \061\000\061\000\061\000\061\000\061\000\061\000\061\000\061\000\
    \061\000\061\000\061\000\061\000\061\000\061\000\061\000\061\000\
    \061\000\061\000\061\000\061\000\061\000\061\000\061\000\061\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\061\000\061\000\
    \061\000\061\000\061\000\061\000\061\000\061\000\061\000\061\000\
    \061\000\061\000\061\000\061\000\061\000\061\000\061\000\061\000\
    \061\000\061\000\061\000\061\000\061\000\061\000\061\000\061\000\
    \062\000\062\000\062\000\062\000\062\000\062\000\062\000\062\000\
    \062\000\062\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\062\000\062\000\062\000\062\000\062\000\062\000\062\000\
    \062\000\062\000\062\000\062\000\062\000\062\000\062\000\062\000\
    \062\000\062\000\062\000\062\000\062\000\062\000\062\000\062\000\
    \062\000\062\000\062\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\062\000\062\000\062\000\062\000\062\000\062\000\062\000\
    \062\000\062\000\062\000\062\000\062\000\062\000\062\000\062\000\
    \062\000\062\000\062\000\062\000\062\000\062\000\062\000\062\000\
    \062\000\062\000\062\000\063\000\063\000\063\000\063\000\063\000\
    \063\000\063\000\063\000\063\000\063\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\063\000\063\000\063\000\063\000\
    \063\000\063\000\063\000\063\000\063\000\063\000\063\000\063\000\
    \063\000\063\000\063\000\063\000\063\000\063\000\063\000\063\000\
    \063\000\063\000\063\000\063\000\063\000\063\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\063\000\063\000\063\000\063\000\
    \063\000\063\000\063\000\063\000\063\000\063\000\063\000\063\000\
    \063\000\063\000\063\000\063\000\063\000\063\000\063\000\063\000\
    \063\000\063\000\063\000\063\000\063\000\063\000\020\000\020\000\
    \020\000\020\000\020\000\020\000\020\000\020\000\020\000\020\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\020\000\
    \020\000\020\000\020\000\020\000\020\000\020\000\020\000\020\000\
    \020\000\020\000\020\000\020\000\020\000\020\000\020\000\020\000\
    \020\000\020\000\020\000\020\000\020\000\020\000\020\000\020\000\
    \020\000\000\000\000\000\000\000\000\000\000\000\000\000\020\000\
    \020\000\020\000\020\000\020\000\020\000\020\000\020\000\020\000\
    \020\000\020\000\020\000\020\000\020\000\020\000\020\000\020\000\
    \020\000\020\000\020\000\020\000\020\000\020\000\020\000\020\000\
    \020\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\000\
    \000\000\000\000\000\000\000\000\000\000\000\000\000\000";
  Lexing.lex_check = 
   "\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\066\000\255\255\255\255\255\255\255\255\003\000\003\000\
    \008\000\003\000\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \066\000\255\255\000\000\001\000\002\000\003\000\004\000\008\000\
    \007\000\008\000\013\000\009\000\009\000\005\000\009\000\022\000\
    \069\000\002\000\003\000\006\000\070\000\003\000\003\000\003\000\
    \003\000\003\000\003\000\003\000\003\000\003\000\003\000\076\000\
    \006\000\255\255\009\000\255\255\255\255\009\000\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\011\000\
    \011\000\255\255\009\000\009\000\009\000\009\000\009\000\009\000\
    \009\000\009\000\009\000\009\000\255\255\255\255\255\255\028\000\
    \029\000\255\255\255\255\009\000\009\000\009\000\009\000\009\000\
    \009\000\009\000\009\000\009\000\009\000\009\000\009\000\009\000\
    \009\000\009\000\009\000\009\000\009\000\009\000\009\000\009\000\
    \009\000\009\000\009\000\009\000\009\000\010\000\014\000\026\000\
    \027\000\009\000\030\000\009\000\009\000\009\000\009\000\009\000\
    \009\000\009\000\009\000\009\000\009\000\009\000\009\000\009\000\
    \009\000\009\000\009\000\009\000\009\000\009\000\009\000\009\000\
    \009\000\009\000\009\000\009\000\009\000\011\000\031\000\023\000\
    \032\000\034\000\035\000\036\000\037\000\038\000\039\000\040\000\
    \041\000\042\000\043\000\065\000\255\255\010\000\023\000\023\000\
    \023\000\072\000\072\000\072\000\072\000\072\000\072\000\072\000\
    \072\000\072\000\072\000\073\000\073\000\073\000\073\000\073\000\
    \073\000\073\000\073\000\073\000\073\000\255\255\255\255\255\255\
    \255\255\010\000\074\000\074\000\074\000\074\000\074\000\074\000\
    \074\000\074\000\074\000\074\000\075\000\075\000\075\000\075\000\
    \075\000\075\000\075\000\075\000\075\000\075\000\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \000\000\001\000\002\000\005\000\004\000\003\000\007\000\008\000\
    \017\000\018\000\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\006\000\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \011\000\255\255\009\000\046\000\046\000\046\000\046\000\046\000\
    \046\000\046\000\046\000\046\000\046\000\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\046\000\046\000\046\000\046\000\
    \046\000\046\000\046\000\046\000\046\000\046\000\046\000\046\000\
    \046\000\046\000\046\000\046\000\046\000\046\000\046\000\046\000\
    \046\000\046\000\046\000\046\000\046\000\046\000\010\000\255\255\
    \255\255\255\255\255\255\255\255\046\000\046\000\046\000\046\000\
    \046\000\046\000\046\000\046\000\046\000\046\000\046\000\046\000\
    \046\000\046\000\046\000\046\000\046\000\046\000\046\000\046\000\
    \046\000\046\000\046\000\046\000\046\000\046\000\047\000\047\000\
    \047\000\047\000\047\000\047\000\047\000\047\000\047\000\047\000\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\047\000\
    \047\000\047\000\047\000\047\000\047\000\047\000\047\000\047\000\
    \047\000\047\000\047\000\047\000\047\000\047\000\047\000\047\000\
    \047\000\047\000\047\000\047\000\047\000\047\000\047\000\047\000\
    \047\000\255\255\255\255\255\255\255\255\047\000\255\255\047\000\
    \047\000\047\000\047\000\047\000\047\000\047\000\047\000\047\000\
    \047\000\047\000\047\000\047\000\047\000\047\000\047\000\047\000\
    \047\000\047\000\047\000\047\000\047\000\047\000\047\000\047\000\
    \047\000\048\000\048\000\048\000\048\000\048\000\048\000\048\000\
    \048\000\048\000\048\000\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\048\000\048\000\048\000\048\000\048\000\048\000\
    \048\000\048\000\048\000\048\000\048\000\048\000\048\000\048\000\
    \048\000\048\000\048\000\048\000\048\000\048\000\048\000\048\000\
    \048\000\048\000\048\000\048\000\255\255\255\255\255\255\255\255\
    \048\000\255\255\048\000\048\000\048\000\048\000\048\000\048\000\
    \048\000\048\000\048\000\048\000\048\000\048\000\048\000\048\000\
    \048\000\048\000\048\000\048\000\048\000\048\000\048\000\048\000\
    \048\000\048\000\048\000\048\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\255\255\
    \255\255\255\255\255\255\049\000\255\255\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\049\000\
    \049\000\049\000\049\000\049\000\049\000\049\000\049\000\050\000\
    \050\000\050\000\050\000\050\000\050\000\050\000\050\000\050\000\
    \050\000\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \050\000\050\000\050\000\050\000\050\000\050\000\050\000\050\000\
    \050\000\050\000\050\000\050\000\050\000\050\000\050\000\050\000\
    \050\000\050\000\050\000\050\000\050\000\050\000\050\000\050\000\
    \050\000\050\000\255\255\255\255\255\255\255\255\050\000\255\255\
    \050\000\050\000\050\000\050\000\050\000\050\000\050\000\050\000\
    \050\000\050\000\050\000\050\000\050\000\050\000\050\000\050\000\
    \050\000\050\000\050\000\050\000\050\000\050\000\050\000\050\000\
    \050\000\050\000\051\000\051\000\051\000\051\000\051\000\051\000\
    \051\000\051\000\051\000\051\000\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\051\000\051\000\051\000\051\000\051\000\
    \051\000\051\000\051\000\051\000\051\000\051\000\051\000\051\000\
    \051\000\051\000\051\000\051\000\051\000\051\000\051\000\051\000\
    \051\000\051\000\051\000\051\000\051\000\255\255\255\255\255\255\
    \255\255\051\000\255\255\051\000\051\000\051\000\051\000\051\000\
    \051\000\051\000\051\000\051\000\051\000\051\000\051\000\051\000\
    \051\000\051\000\051\000\051\000\051\000\051\000\051\000\051\000\
    \051\000\051\000\051\000\051\000\051\000\052\000\052\000\052\000\
    \052\000\052\000\052\000\052\000\052\000\052\000\052\000\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\052\000\052\000\
    \052\000\052\000\052\000\052\000\052\000\052\000\052\000\052\000\
    \052\000\052\000\052\000\052\000\052\000\052\000\052\000\052\000\
    \052\000\052\000\052\000\052\000\052\000\052\000\052\000\052\000\
    \255\255\255\255\255\255\255\255\052\000\255\255\052\000\052\000\
    \052\000\052\000\052\000\052\000\052\000\052\000\052\000\052\000\
    \052\000\052\000\052\000\052\000\052\000\052\000\052\000\052\000\
    \052\000\052\000\052\000\052\000\052\000\052\000\052\000\052\000\
    \053\000\053\000\053\000\053\000\053\000\053\000\053\000\053\000\
    \053\000\053\000\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\053\000\053\000\053\000\053\000\053\000\053\000\053\000\
    \053\000\053\000\053\000\053\000\053\000\053\000\053\000\053\000\
    \053\000\053\000\053\000\053\000\053\000\053\000\053\000\053\000\
    \053\000\053\000\053\000\255\255\255\255\255\255\255\255\255\255\
    \255\255\053\000\053\000\053\000\053\000\053\000\053\000\053\000\
    \053\000\053\000\053\000\053\000\053\000\053\000\053\000\053\000\
    \053\000\053\000\053\000\053\000\053\000\053\000\053\000\053\000\
    \053\000\053\000\053\000\054\000\054\000\054\000\054\000\054\000\
    \054\000\054\000\054\000\054\000\054\000\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\054\000\054\000\054\000\054\000\
    \054\000\054\000\054\000\054\000\054\000\054\000\054\000\054\000\
    \054\000\054\000\054\000\054\000\054\000\054\000\054\000\054\000\
    \054\000\054\000\054\000\054\000\054\000\054\000\255\255\255\255\
    \255\255\255\255\255\255\255\255\054\000\054\000\054\000\054\000\
    \054\000\054\000\054\000\054\000\054\000\054\000\054\000\054\000\
    \054\000\054\000\054\000\054\000\054\000\054\000\054\000\054\000\
    \054\000\054\000\054\000\054\000\054\000\054\000\055\000\055\000\
    \055\000\055\000\055\000\055\000\055\000\055\000\055\000\055\000\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\055\000\
    \055\000\055\000\055\000\055\000\055\000\055\000\055\000\055\000\
    \055\000\055\000\055\000\055\000\055\000\055\000\055\000\055\000\
    \055\000\055\000\055\000\055\000\055\000\055\000\055\000\055\000\
    \055\000\255\255\255\255\255\255\255\255\255\255\255\255\055\000\
    \055\000\055\000\055\000\055\000\055\000\055\000\055\000\055\000\
    \055\000\055\000\055\000\055\000\055\000\055\000\055\000\055\000\
    \055\000\055\000\055\000\055\000\055\000\055\000\055\000\055\000\
    \055\000\056\000\056\000\056\000\056\000\056\000\056\000\056\000\
    \056\000\056\000\056\000\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\056\000\056\000\056\000\056\000\056\000\056\000\
    \056\000\056\000\056\000\056\000\056\000\056\000\056\000\056\000\
    \056\000\056\000\056\000\056\000\056\000\056\000\056\000\056\000\
    \056\000\056\000\056\000\056\000\255\255\255\255\255\255\255\255\
    \255\255\255\255\056\000\056\000\056\000\056\000\056\000\056\000\
    \056\000\056\000\056\000\056\000\056\000\056\000\056\000\056\000\
    \056\000\056\000\056\000\056\000\056\000\056\000\056\000\056\000\
    \056\000\056\000\056\000\056\000\057\000\057\000\057\000\057\000\
    \057\000\057\000\057\000\057\000\057\000\057\000\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\057\000\057\000\057\000\
    \057\000\057\000\057\000\057\000\057\000\057\000\057\000\057\000\
    \057\000\057\000\057\000\057\000\057\000\057\000\057\000\057\000\
    \057\000\057\000\057\000\057\000\057\000\057\000\057\000\255\255\
    \255\255\255\255\255\255\255\255\255\255\057\000\057\000\057\000\
    \057\000\057\000\057\000\057\000\057\000\057\000\057\000\057\000\
    \057\000\057\000\057\000\057\000\057\000\057\000\057\000\057\000\
    \057\000\057\000\057\000\057\000\057\000\057\000\057\000\058\000\
    \058\000\058\000\058\000\058\000\058\000\058\000\058\000\058\000\
    \058\000\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \058\000\058\000\058\000\058\000\058\000\058\000\058\000\058\000\
    \058\000\058\000\058\000\058\000\058\000\058\000\058\000\058\000\
    \058\000\058\000\058\000\058\000\058\000\058\000\058\000\058\000\
    \058\000\058\000\255\255\255\255\255\255\255\255\255\255\255\255\
    \058\000\058\000\058\000\058\000\058\000\058\000\058\000\058\000\
    \058\000\058\000\058\000\058\000\058\000\058\000\058\000\058\000\
    \058\000\058\000\058\000\058\000\058\000\058\000\058\000\058\000\
    \058\000\058\000\059\000\059\000\059\000\059\000\059\000\059\000\
    \059\000\059\000\059\000\059\000\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\059\000\059\000\059\000\059\000\059\000\
    \059\000\059\000\059\000\059\000\059\000\059\000\059\000\059\000\
    \059\000\059\000\059\000\059\000\059\000\059\000\059\000\059\000\
    \059\000\059\000\059\000\059\000\059\000\255\255\255\255\255\255\
    \255\255\255\255\255\255\059\000\059\000\059\000\059\000\059\000\
    \059\000\059\000\059\000\059\000\059\000\059\000\059\000\059\000\
    \059\000\059\000\059\000\059\000\059\000\059\000\059\000\059\000\
    \059\000\059\000\059\000\059\000\059\000\060\000\060\000\060\000\
    \060\000\060\000\060\000\060\000\060\000\060\000\060\000\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\060\000\060\000\
    \060\000\060\000\060\000\060\000\060\000\060\000\060\000\060\000\
    \060\000\060\000\060\000\060\000\060\000\060\000\060\000\060\000\
    \060\000\060\000\060\000\060\000\060\000\060\000\060\000\060\000\
    \255\255\255\255\255\255\255\255\255\255\255\255\060\000\060\000\
    \060\000\060\000\060\000\060\000\060\000\060\000\060\000\060\000\
    \060\000\060\000\060\000\060\000\060\000\060\000\060\000\060\000\
    \060\000\060\000\060\000\060\000\060\000\060\000\060\000\060\000\
    \061\000\061\000\061\000\061\000\061\000\061\000\061\000\061\000\
    \061\000\061\000\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\061\000\061\000\061\000\061\000\061\000\061\000\061\000\
    \061\000\061\000\061\000\061\000\061\000\061\000\061\000\061\000\
    \061\000\061\000\061\000\061\000\061\000\061\000\061\000\061\000\
    \061\000\061\000\061\000\255\255\255\255\255\255\255\255\255\255\
    \255\255\061\000\061\000\061\000\061\000\061\000\061\000\061\000\
    \061\000\061\000\061\000\061\000\061\000\061\000\061\000\061\000\
    \061\000\061\000\061\000\061\000\061\000\061\000\061\000\061\000\
    \061\000\061\000\061\000\062\000\062\000\062\000\062\000\062\000\
    \062\000\062\000\062\000\062\000\062\000\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\062\000\062\000\062\000\062\000\
    \062\000\062\000\062\000\062\000\062\000\062\000\062\000\062\000\
    \062\000\062\000\062\000\062\000\062\000\062\000\062\000\062\000\
    \062\000\062\000\062\000\062\000\062\000\062\000\255\255\255\255\
    \255\255\255\255\255\255\255\255\062\000\062\000\062\000\062\000\
    \062\000\062\000\062\000\062\000\062\000\062\000\062\000\062\000\
    \062\000\062\000\062\000\062\000\062\000\062\000\062\000\062\000\
    \062\000\062\000\062\000\062\000\062\000\062\000\063\000\063\000\
    \063\000\063\000\063\000\063\000\063\000\063\000\063\000\063\000\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\063\000\
    \063\000\063\000\063\000\063\000\063\000\063\000\063\000\063\000\
    \063\000\063\000\063\000\063\000\063\000\063\000\063\000\063\000\
    \063\000\063\000\063\000\063\000\063\000\063\000\063\000\063\000\
    \063\000\255\255\255\255\255\255\255\255\255\255\255\255\063\000\
    \063\000\063\000\063\000\063\000\063\000\063\000\063\000\063\000\
    \063\000\063\000\063\000\063\000\063\000\063\000\063\000\063\000\
    \063\000\063\000\063\000\063\000\063\000\063\000\063\000\063\000\
    \063\000\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\255\
    \255\255\255\255\255\255\255\255\255\255\255\255\255\255"
}

let rec xpm_line lexbuf = __ocaml_lex_xpm_line_rec lexbuf 0
and __ocaml_lex_xpm_line_rec lexbuf state =
  match Lexing.engine lex_tables state lexbuf with
    0 -> (
# 69 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
      
    reset_string_buffer();
    let string_start = Lexing.lexeme_start lexbuf in
    string_start_pos := string_start;
    string lexbuf;
    lexbuf.Lexing.lex_start_pos <-
      string_start - lexbuf.Lexing.lex_abs_pos;
    get_stored_string() )
  | 1 -> (
# 77 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
          raise (BadFile ("",Lexing.lexeme_start lexbuf)))
  | 2 -> (
# 78 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
        xpm_line lexbuf )
  | n -> lexbuf.Lexing.refill_buff lexbuf; __ocaml_lex_xpm_line_rec lexbuf n

and string lexbuf = __ocaml_lex_string_rec lexbuf 1
and __ocaml_lex_string_rec lexbuf state =
  match Lexing.engine lex_tables state lexbuf with
    0 -> (
# 82 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
      () )
  | 1 -> (
# 84 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
        raise (BadFile ("",Lexing.lexeme_start lexbuf))    )
  | 2 -> (
# 86 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
        store_string_char(Lexing.lexeme_char lexbuf 0);
      string lexbuf )
  | n -> lexbuf.Lexing.refill_buff lexbuf; __ocaml_lex_string_rec lexbuf n

and first_line lexbuf = __ocaml_lex_first_line_rec lexbuf 2
and __ocaml_lex_first_line_rec lexbuf state =
  match Lexing.engine lex_tables state lexbuf with
    0 -> (
# 90 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
           
    let dx = nombre lexbuf in
    let dy = nombre lexbuf in
    let colors = nombre lexbuf in
    let nchars = nombre lexbuf in
    ending_string lexbuf;
    (dx,dy,colors,nchars)
  )
  | 1 -> (
# 98 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
           comment lexbuf; first_line lexbuf )
  | 2 -> (
# 99 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
          raise (BadFile ("",Lexing.lexeme_start lexbuf)) )
  | 3 -> (
# 100 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
        first_line lexbuf )
  | n -> lexbuf.Lexing.refill_buff lexbuf; __ocaml_lex_first_line_rec lexbuf n

and nombre lexbuf = __ocaml_lex_nombre_rec lexbuf 3
and __ocaml_lex_nombre_rec lexbuf state =
  match Lexing.engine lex_tables state lexbuf with
    0 -> (
# 103 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
                                       nombre lexbuf )
  | 1 -> (
# 104 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
                      int_of_string(Lexing.lexeme lexbuf) )
  | 2 -> (
# 105 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
                          int_of_string(Lexing.lexeme lexbuf) )
  | 3 -> (
# 106 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
        raise (BadFile ("nombre",Lexing.lexeme_start lexbuf)) )
  | n -> lexbuf.Lexing.refill_buff lexbuf; __ocaml_lex_nombre_rec lexbuf n

and ending_string lexbuf = __ocaml_lex_ending_string_rec lexbuf 4
and __ocaml_lex_ending_string_rec lexbuf state =
  match Lexing.engine lex_tables state lexbuf with
    0 -> (
# 109 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
           () )
  | 1 -> (
# 110 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
        ending_string lexbuf )
  | n -> lexbuf.Lexing.refill_buff lexbuf; __ocaml_lex_ending_string_rec lexbuf n

and comment lexbuf = __ocaml_lex_comment_rec lexbuf 5
and __ocaml_lex_comment_rec lexbuf state =
  match Lexing.engine lex_tables state lexbuf with
    0 -> (
# 113 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
           () )
  | 1 -> (
# 114 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
          raise (BadFile ("",Lexing.lexeme_start lexbuf)) )
  | 2 -> (
# 115 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
        comment lexbuf )
  | n -> lexbuf.Lexing.refill_buff lexbuf; __ocaml_lex_comment_rec lexbuf n

and color_def lexbuf = __ocaml_lex_color_def_rec lexbuf 6
and __ocaml_lex_color_def_rec lexbuf state =
  match Lexing.engine lex_tables state lexbuf with
    0 -> (
# 118 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
           read_chars lexbuf; read_c lexbuf; 
    let color = read_color lexbuf in ending_string lexbuf;
    color )
  | 1 -> (
# 121 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
           comment lexbuf; color_def lexbuf )
  | 2 -> (
# 122 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
        color_def lexbuf )
  | n -> lexbuf.Lexing.refill_buff lexbuf; __ocaml_lex_color_def_rec lexbuf n

and read_chars lexbuf = __ocaml_lex_read_chars_rec lexbuf 7
and __ocaml_lex_read_chars_rec lexbuf state =
  match Lexing.engine lex_tables state lexbuf with
    0 -> (
# 125 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
               
    !code.[String.length !code - !read] <- Lexing.lexeme_char lexbuf 0;
    decr read;
    if !read > 0 then read_chars lexbuf
  )
  | 1 -> (
# 130 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
        raise (BadFile ("chars",Lexing.lexeme_start lexbuf)) )
  | n -> lexbuf.Lexing.refill_buff lexbuf; __ocaml_lex_read_chars_rec lexbuf n

and read_c lexbuf = __ocaml_lex_read_c_rec lexbuf 8
and __ocaml_lex_read_c_rec lexbuf state =
  match Lexing.engine lex_tables state lexbuf with
    0 -> (
# 133 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
                                    () )
  | 1 -> (
# 134 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
               read_c lexbuf )
  | 2 -> (
# 135 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
        raise (BadFile (" c ",Lexing.lexeme_start lexbuf)) )
  | n -> lexbuf.Lexing.refill_buff lexbuf; __ocaml_lex_read_c_rec lexbuf n

and read_color lexbuf = __ocaml_lex_read_color_rec lexbuf 9
and __ocaml_lex_read_color_rec lexbuf state =
  match Lexing.engine lex_tables state lexbuf with
    0 -> (
# 138 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
                                                          
    let hex pos = hexcode lexbuf pos * 16 + hexcode lexbuf (pos+1) in
    let r = hex 1 * 256 + hex 3 in
    let g = hex 5 * 256 + hex 7 in
    let b = hex 9 * 256 + hex 11 in
    RGB(r,g,b)    
  )
  | 1 -> (
# 145 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
                                    
    let hex pos = hexcode lexbuf pos * 16 + hexcode lexbuf (pos+1) in
    let r = (hex 1) * 256  in
    let g = (hex 3) * 256  in
    let b = (hex 5) * 256 in
    RGB(r,g,b)    
  )
  | 2 -> (
# 153 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
                                               NoColor )
  | 3 -> (
# 154 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
                                       Color(Lexing.lexeme lexbuf) )
  | 4 -> (
# 155 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
                                        read_color lexbuf )
  | 5 -> (
# 156 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
        raise (BadFile ("color",Lexing.lexeme_start lexbuf)) )
  | n -> lexbuf.Lexing.refill_buff lexbuf; __ocaml_lex_read_color_rec lexbuf n

and xbm_file lexbuf = __ocaml_lex_xbm_file_rec lexbuf 10
and __ocaml_lex_xbm_file_rec lexbuf state =
  match Lexing.engine lex_tables state lexbuf with
    0 -> (
# 159 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
           comment lexbuf; xbm_file lexbuf )
  | 1 -> (
# 160 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
               width := nombre lexbuf;
      xbm_file lexbuf )
  | 2 -> (
# 162 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
                height := nombre lexbuf;
      xbm_file lexbuf )
  | 3 -> (
# 164 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
               hot_x := nombre lexbuf;
      xbm_file lexbuf )
  | 4 -> (
# 166 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
               hot_y := nombre lexbuf;
      xbm_file lexbuf )
  | 5 -> (
# 168 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
          
      let len = (max (!width / 8) 1) * !height  in
      code := String.create len;
      read := len;
      read_bits lexbuf
    )
  | 6 -> (
# 174 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
          raise (BadFile ("looking for {",Lexing.lexeme_start lexbuf)) )
  | 7 -> (
# 175 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
        xbm_file lexbuf )
  | n -> lexbuf.Lexing.refill_buff lexbuf; __ocaml_lex_xbm_file_rec lexbuf n

and read_bits lexbuf = __ocaml_lex_read_bits_rec lexbuf 11
and __ocaml_lex_read_bits_rec lexbuf state =
  match Lexing.engine lex_tables state lexbuf with
    0 -> (
# 178 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
           comment lexbuf; xbm_file lexbuf )
  | 1 -> (
# 179 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
               
      !code.[String.length !code - !read] <- 
        Char.chr (hexcode lexbuf 2 * 16 + hexcode lexbuf 3);
      decr read;
      if !read > 0 then read_bits lexbuf )
  | 2 -> (
# 184 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
                 raise (BadFile ("looking for 0x",Lexing.lexeme_start lexbuf)) )
  | 3 -> (
# 185 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
        read_bits lexbuf )
  | n -> lexbuf.Lexing.refill_buff lexbuf; __ocaml_lex_read_bits_rec lexbuf n

;;

# 187 "/amoeba/vam-1.5/src/xwin/xlib/xpm.mll"
 
type bitmap_data = int * int * int * int * string
type pixmap_data = int * int * Xtypes.colordef array * int array array
type bitmap = Xtypes.size * Xtypes.size * coord * coord * Xtypes.pixmap
type pixmap = Xtypes.size * Xtypes.size * int * Xtypes.pixmap * Xtypes.pixmap

let readPixmapDataFromFile filename =
Printf.printf "file=%s\n" filename;
  let ic = open_in filename in
  try
    let lexbuf = Lexing.from_channel ic in
    let (dx,dy,ncolors,nchars) = first_line lexbuf in
    let colors = Array.create ncolors NoColor in
    let codes = Hashtbl.create ncolors in
    for i = 0 to ncolors - 1 do
      code := String.create nchars;
      read := nchars;
      colors.(i) <- color_def lexbuf;
      Hashtbl.add codes !code i;
    done;
    let table = Array.init dy (fun _ -> Array.create dx 0) in
    let code = String.create nchars in
    for y = 0 to dy - 1 do
      let line = xpm_line lexbuf in
      if String.length line <> dx * nchars then raise (BadFile ("size",Lexing.lexeme_start lexbuf));
      for x = 0 to dx - 1 do
        for c = 0 to nchars - 1 do
          code.[c] <- line.[x*nchars+c]
        done;
        table.(y).(x) <- Hashtbl.find codes code
      done
    done;
    close_in ic;
    (dx,dy,colors, table)
  with
    myerr -> close_in ic; 
             raise (myerr);
             raise (BadFile ("readPixmapDataFromFile",0))

let readBitmapDataFromFile filename =
  width := 0;
  height := 0;
  hot_x := 0;
  hot_y := 0;
  let ic = open_in filename in
  try
    let lexbuf = Lexing.from_channel ic in
    let _ = xbm_file lexbuf in
    close_in ic;
    (!width,!height,!hot_x, !hot_y, !code)
  with
    e -> close_in ic; raise (BadFile ("readBitmapDataFromFile",0))
      
let drawBitmap display win gc x y  bitmap  =
  let (dx,dy,hot_x,hot_y,bitmap) = bitmap in
  let usize =  display.dpy_bitmap_format_scanline_pad in
  
  let units = ((dx + usize - 1) / usize) * usize / 8  in
  let bx = (dx + 7)/8 in
  
  let data = String.create (units * dy) in
  for y = 0 to dy - 1 do
    for x = 0 to bx - 1 do
      data.[y*units + x] <- bitmap.[y*bx + x]
    done
  done;  
  X.putImage display gc win x y dx dy 0 1 Xtypes.Bitmap
    data

let createBitmapFromData display win bitmap =
  let (dx,dy,hot_x,hot_y,data) = bitmap in
  let pixmap = X.createPixmap display win dx dy 1 in
  let gc = X.createGC display pixmap 
      [GCforeground (id_to_pixel 1); GCbackground (id_to_pixel 0)] in 
  drawBitmap display pixmap gc 0 0 bitmap;
  X.freeGC display gc;
  (dx,dy,hot_x,hot_y,pixmap)

let test f = try f () with e -> Printf.printf "-"; raise e  
  
let createPixmapFromData dpy win cmap depth pixmap = 
(* colors *)
  let (dx,dy,colors,data) = pixmap in
  let ncolors = Array.length colors in
  let mask = ref (-1) in
  let real_colors = Array.create ncolors (id_to_pixel (-1)) in
  for i = 0 to ncolors - 1 do
    try
      match colors.(i) with
        NoColor -> mask := i
      | RGB(r,g,b) -> 
          real_colors.(i) <-
          let ac = X.allocColor dpy cmap r g b in
          ac.ac_pixel
      | Color name ->
          real_colors.(i) <-
          let anc = X.allocNamedColor dpy cmap name in
          anc.anc_pixel
    with
      _ -> Printf.printf "Alloc color failed"; print_newline ()
  done;
  let mask = !mask in
  let pix = Zpixmap.create dpy dx dy depth in
  let width = (dx + 7)/8 in
  let bitmap = if mask <> -1 then String.make (width * dy) '\000'  else ""
  in
  for y = 0 to dy - 1 do
    let line = data.(y) in
    for x = 0 to dx - 1 do
      let color = real_colors.(line.(x)) in
      if pixel_to_id color <> -1 then
        begin
          setPixel pix x y real_colors.(line.(x));
          if mask <> -1 then
            bitmap.[y * width + x / 8 ] <- Char.chr
              ((Char.code bitmap.[y * width + x / 8 ])
              lor (1 lsl (x land 7)));
        end
    done
  done;
  let pixmap = X.createPixmap dpy win dx dy depth in
  let gc = X.createGC dpy pixmap  
    [GCforeground (id_to_pixel 1); GCbackground (id_to_pixel 0)] in  
  Zpixmap.putImage dpy pixmap gc 0 0 pix;
  X.freeGC dpy gc;
  let mask = 
    if mask = -1 then noWindow else
      let (_,_,_,_,pix) = createBitmapFromData dpy win (dx,dy,0,0,bitmap)
      in pix
  in
  (dx,dy,depth,pixmap,mask)
    
  
let createBitmapFromFile dpy win filename =
  createBitmapFromData dpy win (readBitmapDataFromFile filename)

let createPixmapFromFile dpy win cmap depth filename =
  createPixmapFromData dpy win cmap depth (readPixmapDataFromFile filename)

let data_to_string data =
  let s = ref "\n[|" in
  for j = 0 to Array.length data - 1 do
    let line = data.(j) in
    s := !s ^ (if j > 0 then ";[|" else " [|");
    for i = 0 to Array.length line - 1 do
      s := Printf.sprintf "%s%s%d" !s (if i>0 then ";" else "") line.(i)
    done;
    s := !s ^ "|]\n"
  done;
  s := !s ^ " |]"; !s

let colors_to_string colors =
  let s = ref "[|" in
  for i = 0 to Array.length colors - 1 do
    s := (match colors.(i) with
      RGB(r,g,b) -> Printf.sprintf "%s%sXtypes.RGB(%d,%d,%d)\n"
          !s (if i>0 then ";" else "")
          r g b
    | Color n -> Printf.sprintf "%s%sXtypes.Color(\"%s\")\n"
          !s (if i>0 then ";" else "")
          n
    | NoColor -> Printf.sprintf "%s%sXtypes.NoColor\n"
          !s (if i>0 then ";" else ""))
  done;
  s := !s ^ " |]"; !s

let createMLStringFromPixmapData pixmap pixmap_name =
  let (dx,dy,colors,data) = pixmap in
  Printf.sprintf "let %s = (%d,%d,\n(%s),\n(%s))\n" pixmap_name dx dy 
    (colors_to_string colors) (data_to_string data)



  (*

  
open Xtypes
open X
open Xlib  
open Xutils
  
let display = openDisplay ""
let screen = display.dpy_roots.(0)
let root = screen.scr_root
let white = Xutils.defaultWhite display
let black = Xutils.defaultBlack display
let cmap = Xutils.defaultColormap display
let depth = Xutils.defaultDepth display
  

let gc = X.createGC display root [GCforeground black; GCbackground white]

let test filename =
  let (dx,dy,pix,_) = createPixmapFromFile display root cmap depth
      filename in
  X.copyArea display gc pix 0 0 root 10 10 dx dy;;
open Xpm;;
let data = readPixmapDataFromFile "xterm.xpm";;   
let s = createMLStringFromPixmapData data "xterm_pix";;
let oc = open_out "/tmp/pix.ml"
let _ = output_string oc s
let _ = close_out oc;;
  #use "/tmp/pix.ml";;

  *)

